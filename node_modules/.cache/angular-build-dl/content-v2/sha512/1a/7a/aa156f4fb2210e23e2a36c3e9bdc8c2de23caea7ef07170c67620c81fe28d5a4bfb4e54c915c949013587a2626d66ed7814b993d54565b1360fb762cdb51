{"version":3,"sources":["webpack:///src/app/pages/chat/chat.page.html","webpack:///src/app/pages/chat/chat.module.ts","webpack:///src/app/pages/chat/chat.page.scss","webpack:///src/app/pages/chat/chat.page.ts"],"names":["routes","path","component","ChatPageModule","imports","forChild","declarations","ChatPage","route","auth","chatService","router","camera","newMsg","chatTitle","currentUserId","chat","params","subscribe","data","getOneGroup","id","res","messages","getChatMessages","pipe","msg","getMsgFromName","userId","users","usr","nickname","addChatMessage","then","setTimeout","content","scrollToBottom","msgInput","nativeElement","style","height","scrollHeight","newUsers","filter","leaveGroup","navigateByUrl","options","quality","destinationType","DestinationType","DATA_URL","encodingType","EncodingType","JPEG","mediaType","MediaType","PICTURE","sourceType","PictureSourceType","CAMERA","correctOrientation","getPicture","obj","addFileMessage","task","ref","getDownloadURL","url","saveFileMessage","percentageChanges","change","read","selector","template"],"mappings":"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","file":"pages-chat-chat-module-es5.js","sourcesContent":["export default \"<ion-header>\\n    <ion-toolbar color=\\\"primary\\\">\\n      <ion-buttons slot=\\\"start\\\">\\n        <ion-back-button defaultHref=\\\"/chats\\\"></ion-back-button>\\n      </ion-buttons>\\n      <ion-title>{{ chat?.title }}</ion-title>\\n      <ion-buttons slot=\\\"end\\\">\\n        <ion-button  fill=\\\"clear\\\" (click)=\\\"leave()\\\">\\n          Leave Group\\n        </ion-button>\\n      </ion-buttons>\\n    </ion-toolbar>\\n  </ion-header>\\n\\n<ion-content class=\\\"ion-padding\\\">\\n\\n    <ion-grid>\\n        <ion-row *ngFor=\\\"let message of messages | async\\\">\\n\\n          <ion-col size=\\\"9\\\" size-md=\\\"6\\\" *ngIf=\\\"message.from !== currentUserId\\\" class=\\\"message other-message\\\">\\n            <small>{{ message.user }}</small><br>\\n            <span>{{ message.msg }}\\n              <img [src]=\\\"message.file\\\" *ngIf=\\\"message.file\\\">\\n            </span>\\n    \\n            <div class=\\\"time ion-text-right\\\"><br>{{ message.createdAt?.toMillis() | date:'short' }}</div>\\n          </ion-col>\\n    \\n          <ion-col offset=\\\"3\\\" offset-md=\\\"6\\\" size=\\\"9\\\" size-md=\\\"6\\\" *ngIf=\\\"message.from === currentUserId\\\" class=\\\"message my-message\\\">\\n          <small>{{ message.user }}</small><br>\\n            <span>{{ message.msg }}\\n              <img [src]=\\\"message.file\\\" *ngIf=\\\"message.file\\\">\\n            </span>\\n            <div class=\\\"time ion-text-right\\\"><br>{{ message.createdAt?.toMillis() | date:'short' }}</div>\\n          </ion-col>\\n    \\n        </ion-row>\\n      </ion-grid>\\n\\n      <ion-fab vertical=\\\"bottom\\\" horizontal=\\\"end\\\" slot=\\\"fixed\\\">\\n          <ion-fab-button (click)=\\\"sendFile()\\\">\\n            <ion-icon name=\\\"add\\\"></ion-icon>\\n          </ion-fab-button>\\n        </ion-fab>\\n\\n</ion-content>\\n\\n<ion-footer>\\n    <ion-toolbar color=\\\"light\\\">\\n      <ion-row no-padding align-items-center>\\n        <ion-col size=\\\"10\\\">\\n          <textarea class=\\\"message-input\\\" #input rows=\\\"1\\\" maxLength=\\\"500\\\" (keyup)=\\\"resize()\\\" \\n          [(ngModel)]=\\\"newMsg\\\"></textarea>\\n        </ion-col>\\n        <ion-col size=\\\"2\\\" text-center>\\n          <ion-button expand=\\\"block\\\" fill=\\\"clear\\\" color=\\\"primary\\\" [disabled]=\\\"newMsg === ''\\\" class=\\\"msg-btn\\\" (click)=\\\"sendMessage()\\\">\\n            <ion-icon name=\\\"send\\\" slot=\\\"icon-only\\\"></ion-icon>\\n          </ion-button>\\n        </ion-col>\\n      </ion-row>\\n    </ion-toolbar>\\n  </ion-footer>\\n  \";","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ChatPage } from './chat.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: ChatPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [ChatPage]\n})\nexport class ChatPageModule {}\n","export default \".message {\\n  padding: 10px !important;\\n  border-radius: 10px !important;\\n  margin-bottom: 4px !important;\\n}\\n.message img {\\n  width: 100%;\\n}\\n.my-message {\\n  background: lightgreen;\\n  color: black;\\n}\\n.other-message {\\n  background: var(--ion-color-light);\\n  color: black;\\n}\\n.time {\\n  color: var(--ion-color-medium);\\n  float: right;\\n  font-size: small;\\n}\\n.message-input {\\n  width: 100%;\\n  border: 1px solid var(--ion-color-medium);\\n  border-radius: 10px;\\n  background: #fff;\\n  resize: none;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy90ZWphc3JhbWFuaS9PdGhlci13ZWJkZXYvaW9uaWMvaW9uaWMtZmlyZWJhc2UtY2hhdC12Mi9zcmMvYXBwL3BhZ2VzL2NoYXQvY2hhdC5wYWdlLnNjc3MiLCJzcmMvYXBwL3BhZ2VzL2NoYXQvY2hhdC5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSx3QkFBQTtFQUNBLDhCQUFBO0VBQ0EsNkJBQUE7QUNDSjtBRENJO0VBQ0UsV0FBQTtBQ0NOO0FERUU7RUFFRSxzQkFBQTtFQUNBLFlBQUE7QUNBSjtBREdFO0VBR0Usa0NBQUE7RUFDQSxZQUFBO0FDRko7QURLQTtFQUVFLDhCQUFBO0VBQ0EsWUFBQTtFQUNBLGdCQUFBO0FDSEY7QURNQTtFQUNJLFdBQUE7RUFDQSx5Q0FBQTtFQUNBLG1CQUFBO0VBQ0EsZ0JBQUE7RUFDQSxZQUFBO0FDSEoiLCJmaWxlIjoic3JjL2FwcC9wYWdlcy9jaGF0L2NoYXQucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLm1lc3NhZ2Uge1xuICAgIHBhZGRpbmc6IDEwcHggIWltcG9ydGFudDtcbiAgICBib3JkZXItcmFkaXVzOiAxMHB4ICFpbXBvcnRhbnQ7XG4gICAgbWFyZ2luLWJvdHRvbTogNHB4ICFpbXBvcnRhbnQ7XG5cbiAgICBpbWcge1xuICAgICAgd2lkdGg6IDEwMCU7XG4gICAgfVxuICB9XG4gIC5teS1tZXNzYWdlIHtcbiAgICAvLyBiYWNrZ3JvdW5kOiB2YXIoLS1pb24tY29sb3ItdGVydGlhcnkpO1xuICAgIGJhY2tncm91bmQ6IGxpZ2h0Z3JlZW47XG4gICAgY29sb3I6IGJsYWNrO1xuICAgIC8vIGNvbG9yOiAjZmZmO1xuICB9XG4gIC5vdGhlci1tZXNzYWdlIHtcbiAgICAvLyBiYWNrZ3JvdW5kOiB2YXIoLS1pb24tY29sb3ItbWVkaXVtKTtcbiAgICAvLyBjb2xvcjogI2ZmZjtcbiAgICBiYWNrZ3JvdW5kOiB2YXIoLS1pb24tY29sb3ItbGlnaHQpO1xuICAgIGNvbG9yOiBibGFjaztcbiAgfVxuXG4udGltZSB7XG4gIC8vIGNvbG9yOiAjZGZkZmRmO1xuICBjb2xvcjogdmFyKC0taW9uLWNvbG9yLW1lZGl1bSk7XG4gIGZsb2F0OiByaWdodDtcbiAgZm9udC1zaXplOiBzbWFsbDtcbn1cblxuLm1lc3NhZ2UtaW5wdXQge1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLWlvbi1jb2xvci1tZWRpdW0pO1xuICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7XG4gICAgYmFja2dyb3VuZDogI2ZmZjtcbiAgICByZXNpemU6IG5vbmU7XG59XG5cbiIsIi5tZXNzYWdlIHtcbiAgcGFkZGluZzogMTBweCAhaW1wb3J0YW50O1xuICBib3JkZXItcmFkaXVzOiAxMHB4ICFpbXBvcnRhbnQ7XG4gIG1hcmdpbi1ib3R0b206IDRweCAhaW1wb3J0YW50O1xufVxuLm1lc3NhZ2UgaW1nIHtcbiAgd2lkdGg6IDEwMCU7XG59XG5cbi5teS1tZXNzYWdlIHtcbiAgYmFja2dyb3VuZDogbGlnaHRncmVlbjtcbiAgY29sb3I6IGJsYWNrO1xufVxuXG4ub3RoZXItbWVzc2FnZSB7XG4gIGJhY2tncm91bmQ6IHZhcigtLWlvbi1jb2xvci1saWdodCk7XG4gIGNvbG9yOiBibGFjaztcbn1cblxuLnRpbWUge1xuICBjb2xvcjogdmFyKC0taW9uLWNvbG9yLW1lZGl1bSk7XG4gIGZsb2F0OiByaWdodDtcbiAgZm9udC1zaXplOiBzbWFsbDtcbn1cblxuLm1lc3NhZ2UtaW5wdXQge1xuICB3aWR0aDogMTAwJTtcbiAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0taW9uLWNvbG9yLW1lZGl1bSk7XG4gIGJvcmRlci1yYWRpdXM6IDEwcHg7XG4gIGJhY2tncm91bmQ6ICNmZmY7XG4gIHJlc2l6ZTogbm9uZTtcbn0iXX0= */\";","import { Camera, CameraOptions } from '@ionic-native/camera/ngx';\nimport { Observable } from 'rxjs';\nimport { ChatService } from './../../services/chat.service';\nimport { AuthService } from './../../services/auth.service';\nimport { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { IonContent } from '@ionic/angular';\nimport { map } from 'rxjs/operators';\n\n@Component({\n  selector: 'app-chat',\n  templateUrl: './chat.page.html',\n  styleUrls: ['./chat.page.scss'],\n})\nexport class ChatPage implements OnInit {\n\n  messages: Observable<any[]>;\n  newMsg = '';\n  chatTitle = '';\n  currentUserId = this.auth.currentUserId;\n  chat = null;\n\n  @ViewChild(IonContent) content: IonContent;\n  @ViewChild('input', { read: ElementRef }) msgInput: ElementRef;\n\n  constructor(\n    private route: ActivatedRoute, \n    private auth: AuthService, \n    private chatService: ChatService, \n    private router: Router, \n    private camera: Camera) { }\n\n  ngOnInit() {\n    this.route.params.subscribe(data => {\n      this.chatService.getOneGroup(data.id).subscribe(res => {\n        this.chat = res;\n        // console.log('my chat: ', this.chat);\n        this.messages = this.chatService.getChatMessages(this.chat.id).pipe(\n          map(messages => {\n            for (let msg of messages) {\n              msg['user'] = this.getMsgFromName(msg['from']);\n            }\n            // console.log('messages: ', messages);\n            return messages;\n          })\n        );\n      })\n    })\n  }\n\n  getMsgFromName(userId) {\n    for (let usr of this.chat.users) {\n      if (usr.id == userId) {\n        return usr.nickname;\n      }\n    }\n    return 'Deleted';\n  }\n\n  sendMessage() {\n    this.chatService.addChatMessage(this.newMsg, this.chat.id).then(() => {\n      this.newMsg = '';\n      // this.content.scrollToBottom();\n      //for autoscrolling to bottom...\n      setTimeout(() => {\n        this.content.scrollToBottom(200);\n      });\n    });\n  }\n\n  resize() {\n    this.msgInput.nativeElement.style.height = this.msgInput.nativeElement.scrollHeight + 'px';\n  }\n\n  leave() {\n    let newUsers = this.chat.users.filter(usr => usr.id != this.auth.currentUserId);\n\n    this.chatService.leaveGroup(this.chat.id, newUsers).subscribe(res => {\n      this.router.navigateByUrl('/chats');\n    });\n  }\n\n  sendFile() {\n    const options: CameraOptions = {\n      quality: 70,\n      destinationType: this.camera.DestinationType.DATA_URL,\n      encodingType: this.camera.EncodingType.JPEG,\n      mediaType: this.camera.MediaType.PICTURE,\n      sourceType: this.camera.PictureSourceType.CAMERA,\n      correctOrientation: true\n    }\n\n    this.camera.getPicture(options).then(data => {\n\n      let obj = this.chatService.addFileMessage(data, this.chat.id);\n      let task = obj.task;\n\n      task.then(res => {\n        obj.ref.getDownloadURL().subscribe(url => {\n          this.chatService.saveFileMessage(url, this.chat.id);\n        })\n      });\n\n      task.percentageChanges().subscribe(change => {\n        // console.log('change: ', change);\n      })\n    });\n\n    \n  }\n}\n"]}